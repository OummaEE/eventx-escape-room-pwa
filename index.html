<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EventX - Evenemangsbokningar</title>
    <meta name="description" content="Modern PWA-applikation för evenemangsbokningar med push-notifikationer och Apple Pay">
    <meta name="keywords" content="bokning, evenemang, PWA, biljetter, Apple Pay">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="EventX">
    
    <!-- Open Graph -->
    <meta property="og:title" content="EventX - Evenemangsbokningar">
    <meta property="og:description" content="Modern PWA-applikation för evenemangsbokningar">
    
    <!-- Twitter -->
    <meta name="twitter:title" content="EventX - Evenemangsbokningar">
    <meta name="twitter:description" content="Modern PWA-applikation för evenemangsbokningar">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <script src="https://resource.trickle.so/vendor_lib/unpkg/react@18/umd/react.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://resource.trickle.so/vendor_lib/unpkg/lucide-static@0.516.0/font/lucide.css" rel="stylesheet">
    
    <!-- Stripe -->
    <script src="https://js.stripe.com/v3/"></script>

    <style type="text/tailwindcss">
    @layer theme {
        :root {
            --primary-color: #6366f1;
            --secondary-color: #f1f5f9;
            --accent-color: #10b981;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }
    }

    @layer base {
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-primary);
        }
        
        * {
            box-sizing: border-box;
        }
    }

    @layer components {
        .btn-primary {
            @apply bg-[var(--primary-color)] text-white px-6 py-3 rounded-xl font-medium;
            @apply hover:bg-indigo-700 active:scale-95 transition-all duration-200;
            @apply shadow-[var(--shadow-md)] hover:shadow-[var(--shadow-lg)];
        }
        
        .btn-secondary {
            @apply bg-white text-[var(--text-primary)] px-6 py-3 rounded-xl font-medium;
            @apply border border-[var(--border-color)] hover:bg-gray-50;
            @apply active:scale-95 transition-all duration-200;
            @apply shadow-[var(--shadow-sm)] hover:shadow-[var(--shadow-md)];
        }
        
        .card {
            @apply bg-white rounded-2xl p-6 shadow-[var(--shadow-md)];
            @apply border border-[var(--border-color)] backdrop-blur-sm;
        }
        
        .input-field {
            @apply w-full px-4 py-3 border border-[var(--border-color)] rounded-xl;
            @apply focus:ring-2 focus:ring-[var(--primary-color)] focus:border-transparent;
            @apply transition-all duration-200 bg-white;
        }
        
        .bottom-nav {
            @apply fixed bottom-0 left-0 right-0 bg-white border-t border-[var(--border-color)];
            @apply flex items-center justify-around py-2 px-4 z-50;
            @apply shadow-[0_-4px_6px_-1px_rgb(0_0_0_/_0.1)] backdrop-blur-md;
        }
        
        .nav-item {
            @apply flex flex-col items-center gap-1 p-2 rounded-xl;
            @apply text-[var(--text-secondary)] hover:text-[var(--primary-color)];
            @apply transition-colors duration-200 cursor-pointer;
        }
        
        .nav-item.active {
            @apply text-[var(--primary-color)] bg-[var(--primary-color)] bg-opacity-10;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.4s ease-out forwards;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    }
    </style>

</head>
<body>
    <div id="root"></div>
    
    <!-- Service Worker Registration -->
    <script>
        // Clear all caches on page load
        if ('caches' in window) {
            caches.keys().then(function(names) {
                names.forEach(function(name) {
                    console.log('Deleting cache:', name);
                    caches.delete(name);
                });
            });
        }

        if ('serviceWorker' in navigator) {
            // Unregister existing service workers first
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) {
                    console.log('Unregistering old service worker');
                    registration.unregister();
                }
            }).then(() => {
                // Register new service worker
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('sw.js', { updateViaCache: 'none' })
                        .then((registration) => {
                            console.log('SW registered: ', registration);
                            
                            // Force immediate update check
                            registration.update();
                            
                            // Check for updates every 10 seconds (more frequent)
                            setInterval(() => {
                                console.log('Checking for SW updates...');
                                registration.update();
                            }, 10000);
                            
                            // Listen for new service worker installation
                            registration.addEventListener('updatefound', () => {
                                console.log('New service worker found!');
                                const newWorker = registration.installing;
                                
                                newWorker.addEventListener('statechange', () => {
                                    console.log('SW state changed to:', newWorker.state);
                                    if (newWorker.state === 'installed') {
                                        if (navigator.serviceWorker.controller) {
                                            // New service worker is available, refresh the page
                                            console.log('New service worker available, refreshing...');
                                            window.location.reload(true); // Hard reload
                                        }
                                    }
                                });
                            });
                        })
                        .catch((registrationError) => {
                            console.log('SW registration failed: ', registrationError);
                        });
                    
                    // Listen for service worker controller change
                    navigator.serviceWorker.addEventListener('controllerchange', () => {
                        console.log('Service worker controller changed, refreshing...');
                        window.location.reload(true); // Hard reload
                    });
                });
            });
        }
    </script>
    
    <script type="text/babel" src="utils/i18n.js"></script>
    <script type="text/babel" src="utils/notifications.js"></script>
    <script type="text/babel" src="utils/wallet.js"></script>
    <script type="text/babel" src="utils/payments.js"></script>
    <script type="text/babel" src="utils/storage.js"></script>
    <script type="text/babel" src="components/BottomNavigation.js"></script>
    <script type="text/babel" src="components/EventCard.js"></script>
    <script type="text/babel" src="components/BookingModal.js"></script>
    <script type="text/babel" src="components/PaymentModal.js"></script>
    <script type="text/babel" src="screens/HomeScreen.js"></script>
    <script type="text/babel" src="screens/EventsScreen.js"></script>
    <script type="text/babel" src="screens/BookingsScreen.js"></script>
    <script type="text/babel" src="screens/PhotosScreen.js"></script>
    <script type="text/babel" src="screens/WalletScreen.js"></script>
    <script type="text/babel" src="screens/ProfileScreen.js"></script>
    <script type="text/babel" src="app.js"></script>
</body>
</html>